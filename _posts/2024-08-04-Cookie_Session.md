---
title: pre.Web(1주차)-Cookie & Session
published: true
---

|

# 쿠기와 세션

## 쿠키 (Cookies)

*웹 서버*가 *사용자의 웹 브라우저에 저장*하는 작은 데이터 조각

사용자가 *웹사이트를 방문할 때 생성*됨

이후 웹사이트에 다시 방문할 때, 웹 브라우저가 서버로 쿠키 전송

쿠키를 통해 웹 서버가 사용자를 식별, 사용자 맞춤형 서비스 제공

### 특징

**`저장 위치`**: 쿠키는 클라이언트(사용자의 웹 브라우저)에 저장됨

|

**`데이터 용량`**: 일반적으로 각 쿠키는 4KB 이하의 데이터를 저장 가능

하나의 도메인당 여러 개의 쿠키를 저장할 수 있음

|

**`유효 기간`**: 쿠키에는 만료 시간이 설정될 수 있음

만료 시간이 설정된 쿠키는 해당 시간까지 유지되며, 설정되지 않은 쿠키는 브라우저를 닫을 때까지 유지됨

|

**`보안`**: 쿠키는 평문으로 저장되기 때문에 민감한 정보는 저장하지 않는 것이 좋음

HTTPS를 통해 전송하면 데이터가 암호화되지만, 여전히 브라우저에 저장된 데이터는 보호되지 않음

|

### 사용 사례

**`자동 로그인`**: 사용자가 로그인할 때 쿠키에 사용자 정보를 저장

재방문 시 자동 로그인 구현

|

**`쇼핑 카트`**: 사용자가 장바구니에 담은 상품 목록을 쿠키에 저장

페이지를 이동하거나 브라우저를 닫았다가 다시 열 때도 장바구니 상태를 유지

|

**`사용자 설정`**: 웹사이트의 언어 설정이나 테마 설정 등을 쿠키에 저장

사용자가 재방문할 때 동일한 설정을 유지

|

## 세션 (Sessions)

서버 측에서 관리되는 *사용자 상태 정보*

사용자가 웹사이트에 접속하면 생성됨

사용자가 웹사이트와 상호 작용하는 동안 서버에 사용자 상태 정보 저장

일정 시간이 지나면 만료됨

### 특징

**`저장 위치`**: 세션 데이터는 서버에 저장됨

클라이언트는 세션 ID만을 가지고 있음

이 세션 ID를 통해 서버에 저장된 세션 데이터를 조회

|

**`데이터 용량`**: 서버 측에 저장됨

저장 용량이 클라이언트에 비해 상대적으로 크고, 데이터 크기에 제한이 적음

|

**`유효 기간`**: 세션은 일정 시간 동안 활동이 없으면 만료됨(세션 타임아웃)

|

**`보안`**: 세션 ID만 클라이언트에 저장되므로 데이터 유출의 위험이 적음

하지만 세션 ID가 탈취되면 세션 하이재킹 공격이 가능함

|

### 사용 사례

**`인증`**: 사용자가 로그인하면 세션에 사용자 정보를 저장

사용자가 웹사이트의 다른 페이지를 이동할 때도 로그인 상태를 유지

|

**`개인화`**: 사용자별로 맞춤형 데이터를 제공하기 위해 세션에 사용자 정보를 저장

이를 기반으로 개인화된 콘텐츠를 제공

|

**`상태 유지`**: 사용자가 여러 단계에 걸친 양식을 작성하는 경우, 각 단계의 데이터를 세션에 저장하여 상태를 유지

|

## 비교

| 특징        | 쿠키                     | 세션                            |
|:------------|:-------------------------|:--------------------------------|
| 저장 위치   | 클라이언트               | 서버                            |
| 데이터 용량 | 작음 (4KB 이하)          | 큼 (서버 저장 용량에 따라 다름) |
| 유효 기간   | 만료 시간 설정 가능      | 일정 시간 동안 활동 없으면 만료 |
| 보안        | 상대적으로 낮음          | 상대적으로 높음                 |
| 사용 사례   | 자동 로그인, 사용자 설정 | 인증, 개인화, 상태 유지         |

|

---

|

# 쿠키와 세션의 발전 과정

## `쿠키 (Cookies)` 발전 과정

### 초기 도입

**`1994년`**: 넷스케이프 내비게이터(Netscape Navigator) 웹 브라우저의 일부로 처음 도입됨

당시 쿠키의 주 목적은 *온라인 쇼핑 카트 구현*

쿠키를 사용해 사용자가 장바구니에 담은 상품을 기억할 수 있었음

|

**`RFC 2109 (1997년)`**: 쿠키의 초기 표준화 시도

쿠키의 구조와 사용법을 정의

실제로는 널리 채택되지 않음

|

### 발전 및 표준화

**`RFC 2965 (2000년)`**: 이전 표준의 한계 보완

쿠키의 보안 강화

도메인과 경로 속성을 통해 쿠키의 적용 범위를 명확히 규정

|

**`HTTPOnly 및 Secure 플래그 (2002년)`**: XSS 공격 방지를 위해 *HTTPOnly 플래그* 도입

*HTTPOnly 플래그*를 설정하면, JavaScript에서 쿠키에 접근할 수 없게됨

*Secure 플래그*는 쿠키가 HTTPS 연결을 통해서만 전송되도록 함

|

### 최근 발전

**`SameSite 플래그 (2016년)`**: CSRF 공격을 방지하기 위해 쿠키의 SameSite 속성 도입

쿠키가 동일한 사이트 내에서만 전송되도록 제한

|

**`GDPR 및 CCPA (2018년)`**: 쿠키 사용에 대한 투명성 및 사용자 동의가 강조됨

유럽 연합의 *일반 데이터 보호 규칙(GDPR)*과 *캘리포니아 소비자 프라이버시법(CCPA)* 시행으로 인함

웹사이트는 쿠키 배너와 같은 사용자 동의 메커니즘을 구현하게 됨

|

## `세션 (Sessions)` 발전 과정

### 초기 도입

**`초기 웹 애플리케이션`**: 초창기 웹은 상태 비유지(stateles) 프로토콜인 HTTP 기반

때문에 각 요청 간의 상태를 유지하는 것이 어려웠음

이를 해결하기 위해 서버 측에서 상태를 유지할 수 있는 세션 관리가 도입됨

|

**`ASP 및 JSP`**: 마이크로소프트의 *ASP(Active Server Pages)*와 *자바 서블릿(Java Servlets)*, *JSP(JavaServer Pages)*와 같은 서버 측 기술이 세션 관리를 지원하기 시작

|

## 발전 및 표준화

**`세션 쿠키`**: 세션 ID를 쿠키에 저장

클라이언트가 각 요청 시 세션 ID를 서버로 전송하도록 하는 방식이 널리 사용됨

이 방식은 세션을 유지하면서도 클라이언트 측에 최소한의 데이터만 저장할 수 있었음

|

**`서버 클러스터링 및 로드 밸런싱`**: 웹 애플리케이션이 확장됨에 따라, 세션 관리는 더욱 복잡해짐

서버 클러스터링과 로드 밸런싱 환경에서 세션을 유지하기 위해 *세션 복제(session replication)*나 *세션 스토리지(session storage)* 기술이 도입됨

|

## 최근 발전

**`JWT (JSON Web Tokens)`**: 최근에는 서버리스 아키텍처와 클라이언트 측 상태 관리를 위해 JWT가 널리 사용됨

JWT는 세션 정보를 클라이언트 측에서 안전하게 저장하고 검증할 수 있게 해줌

|

**`OAuth 및 OpenID Connect`**: OAuth와 OpenID Connect와 같은 인증 및 권한 부여 표준이 도입

세션 관리는 더 복잡한 사용자 인증 흐름을 지원할 수 있게 됨

이를 통해 다양한 애플리케이션 간에 인증 상태를 공유하고, 보다 안전하게 세션을 관리할 수 있음

|

---

|

# JWT (JSON Web Token)

웹 애플리케이션에서 인증과 권한 부여를 위한 *개방형 표준(RFC 7519)*

*JSON 객체를 사용*해 클레임을 안전하게 전송하는 방법을 정의

*OAuth 2.0*과 같은 인증 시스템에서 사용됨

클라이언트-서버 간 정보를 안전하게 교환하기 위해 사용됨

|

## JWT 구조 (헤더, 페이로드, 서명)

세 부분으로 구성된 문자열

각 부분은 점(.)으로 구분됨

헤더, 페이로드, 서명 각 부분을 *Base64Url로 인코딩*하여 점으로 연결한 문자열이 JWT 

|

### 1. 헤더(Header)

토큰의 유형, 해싱 알고리즘 정의

일반적으로 두 가지 정보를 포함(alg, typ)

|

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**`alg`**: 서명에 사용할 해싱 알고리즘 (예: HMAC SHA256)

**`typ`**: 토큰의 유형 (JWT)

|

### 2. 페이로드(Payload)

토큰에 포함된 클레임(claims)을 담고 있음

**클레임**: 세 가지 유형으로 나뉘며, 엔티티(사용자)와 추가 메타데이터에 대한 정보를 담고 있음

**`등록된 클레임(Registered claims)`**: 사전에 정의된 클레임 (예: iss, exp, sub, aud 등)

**`공개 클레임(Public claims)`**: 사용자 정의 클레임으로 충돌 방지를 위해 URI 형식을 권장

**`비공개 클레임(Private claims)`**: 클라이언트와 서버 간에 협의된 클레임

|

```json
{
  "sub": "1234567890",
  "name": "Pack",
  "admin": true,
  "iat": 1516239022
}
```

**`sub`**: 주체(subject)의 ID

**`name`**: 사용자의 이름

**`admin`**: 관리자 여부

**`iat`**: 토큰이 발행된 시간 (issued at)

|

### 3. 서명(Signature)

토큰의 무결성을 확인하는 데 사용

헤더와 페이로드를 결합, 비밀 키와 함께 지정된 해싱 알고리즘을 사용해 생성

|

> HMAC SHA256을 사용하는 경우

```js
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
```

|

> 서명 완료된 JWT는 다음과 같이 구성

```
xxxxx.yyyyy.zzzzz
```

|

## JWT 작동 방식

### 1. 토큰 생성

사용자가 로그인하면, 서버는 사용자 정보를 포함한 JWT 생성

서버는 헤더와 페이로드를 Base64Url로 인코딩하고, 이를 비밀 키로 서명하여 JWT 생성

|

### 2. 토큰 전송

생성된 JWT는 클라이언트에게 전달됨

HTTP 헤더의 *'Authorization: Bearer <token>'* 형식으로 전송됨

|

### 3. 토큰 검증

클라이언트가 서버에 요청을 보낼 때, JWT를 포함해 전송

서버는 JWT를 검증하여 서명이 유효한지 확인

이후 페이로드의 클레임을 검토하여 요청을 처리

|

## JWT 장점

**`자체 포함`**: JWT는 필요한 모든 정보를 자체적으로 포함

별도의 데이터베이스 조회가 필요 없음

|

**`간편한 사용`**: JSON 형식을 사용

읽기 쉽고, 다양한 프로그래밍 언어에서 쉽게 사용할 수 있음

|

**`확장성`**: *등록된 클레임*, *공개 클레임*, *비공개 클레임*을 통해 다양한 정보를 유연하게 포함할 수 있음

|

**`보안`**: 비밀 키로 서명되어 무결성을 보장

*RSA*나 *ECDSA*와 같은 *공개 키 암호화*를 사용하여 보안을 강화할 수 있습니다.

|

## JWT 단점

**`페이로드 크기`**: JWT는 자체 포함 정보를 모두 포함

페이로드 크기가 클 수 있으며, 이는 네트워크 트래픽을 증가시킬 수 있습니다.

|

**`토큰 철회`**: JWT는 발급 후 서버에서 상태를 유지하지 않음

토큰을 철회하거나 무효화하는 것이 어려움

이를 해결하기 위해 블랙리스트나 짧은 만료 시간을 사용

|

**`보안 위험`**: 서명된 JWT는 암호화된 것이 아님

누구나 내용을 읽을 수 있음

민감한 정보를 JWT에 포함하지 않도록 주의해야 함

|

---

|

# 브라우저 저장소

**주요 기술**:  

쿠키 (Cookies)

로컬 스토리지 (Local Storage)

세션 스토리지 (Session Storage)

인덱스드 DB (IndexedDB)

웹 SQL (Web SQL)

서비스 워커와 캐시 (Service Workers and Cache Storage)

|

## 1. 쿠키 (Cookies)

### 특징
**`크기 제한`**: *약 4KB*

하나의 도메인에 여러 개의 쿠키를 저장 가능

|

**`만료 기간`**: 만료 기간을 설정 가능

만료 기간이 설정되지 않은 쿠키는 브라우저 세션이 끝날 때까지 유지됨

|

**`보안`**: HTTPOnly 플래그를 사용하면 클라이언트 측 스크립트에서 접근할 수 없음

Secure 플래그를 사용하면 HTTPS를 통해서만 전송됨

|

### 사용 사례

**`세션 관리`**: 사용자 로그인 상태를 유지

|

**`사용자 설정`**: 사용자 설정(예: 언어, 테마 등)을 저장

|

**`추적`**: 사용자의 웹사이트 방문 및 행동을 추적하는 데 사용

|

## 2. 로컬 스토리지 (Local Storage)

### 특징

**`크기 제한`**: 각 도메인마다 약 *5MB ~ 10MB*

|

**`만료 기간`**: 로컬 스토리지에 저장된 데이터는 명시적으로 삭제하지 않는 한 *영구적*으로 유지됨

|

**`보안`**: HTTP와 HTTPS에서 모두 사용 가능

데이터를 평문으로 저장하므로 민감한 정보를 저장하는 것은 권장되지 않음

|

### 사용 사례

**`오프라인 데이터 저장`**: 인터넷 연결이 없는 *오프라인 상황에서도 데이터를 저장*하고, 나중에 동기화할 수 있음

|

**`사용자 설정`**: 사용자별 설정을 장기간 저장할 수 있음

|

## 3. 세션 스토리지 (Session Storage)

### 특징

**`크기 제한`**: 각 도메인마다 약 5MB ~ 10MB

|

**`만료 기간`**: 브라우저 탭 또는 창이 닫히면 데이터가 삭제됨

|

**`보안`**: 동일한 출처 정책(Same-Origin Policy)을 따름

|

### 사용 사례

**`일시적인 데이터 저장`**: 브라우저 세션 동안만 유지되는 데이터를 저장

|

**`폼 데이터`**: 페이지 이동 중에도 폼 데이터가 유지되도록 함

|

## 4. 인덱스드 DB (IndexedDB)

### 특징

**`크기 제한`**: 매우 큰 데이터를 저장, GB 단위의 데이터도 저장 가능

|

**`구조화된 데이터`**: 객체 저장소(Object Store)를 사용하여 구조화된 데이터를 저장

인덱스를 통해 효율적으로 검색 가능

|

**`비동기 API`**: 비동기 API를 사용하여 데이터를 처리

|

### 사용 사례

**`복잡한 데이터 저장`**: 구조화된 대량의 데이터를 저장, 쿼리를 통해 검색 가능

|

**`오프라인 애플리케이션`**: *오프라인 상태에서도 동작*하는 복잡한 웹 애플리케이션을 지원

|

## 5. 웹 SQL (Web SQL)

### 특징

**`크기 제한`**: 브라우저에 따라 다르며, 대개 로컬 스토리지보다 큰 데이터를 저장

|

**`SQL 인터페이스`**: SQL 쿼리를 사용하여 데이터를 저장하고 조회

|

**`지원 중단`**: 웹 SQL은 *표준화가 중단*되어, 일부 최신 브라우저에서는 더 이상 지원되지 않을 수 있습니다.

|

### 사용 사례

**`구조화된 데이터 저장`**: SQL을 사용하여 구조화된 데이터를 저장하고 관리

|

## 6. 서비스 워커와 캐시 (Service Workers and Cache Storage)

### 특징

**`오프라인 지원`**: 서비스 워커는 네트워크 요청을 가로채고, 캐시에 저장된 리소스를 제공하여 오프라인 동작을 지원함

|

**`비동기 API`**: 비동기 API를 사용하여 캐시를 관리하고, 네트워크 요청을 처리

|

### 사용 사례

**`오프라인 웹 애플리케이션`**: 사용자가 오프라인 상태에서도 웹 애플리케이션을 사용할 수 있도록 지원

|

**`효율적인 캐싱`**: 자주 사용하는 리소스를 캐시에 저장

네트워크 요청을 최소화하고, 성능을 향상시킴

|

## 정리

| 저장소 유형 | 크기 제한 | 만료 기간 | 보안 | 주요 사용 사례 |
|:-----------|:---------|:----------|:----|:---------------|
| 쿠키 (Cookies) | 약 4KB | 설정된 만료 시간 또는 세션 종료 시 | HTTPOnly, Secure 플래그로 보안 강화 가능 | 세션 관리, 사용자 설정, 사용자 추적 | 
| 로컬 스토리지 (Local Storage) | 약 5MB~10MB | 영구적 | HTTP와 HTTPS에서 모두 사용 가능, 평문 저장 | 오프라인 데이터 저장, 장기 사용자 설정 |
| 세션 스토리지 (Session Storage) | 약 5MB~10MB | 브라우저 탭/창 닫힘 시 | 동일한 출처 정책(Same-Origin Policy) 적용 | 일시적 데이터 저장, 페이지 이동 시 폼 데이터 유지 |
| 인덱스드 DB (IndexedDB) | 매우 큼 (GB 단위) | 영구적 | 동일한 출처 정책 적용, 구조화된 데이터 저장 | 복잡한 데이터 저장, 오프라인 애플리케이션 지원 |
| 웹 SQL (Web SQL) | 브라우저에 따라 다름 | 영구적 | SQL 쿼리 사용, 일부 최신 브라우저에서는 더 이상 지원되지 않음 | 구조화된 데이터 저장 및 관리 |
| 서비스 워커와 캐시 (Service Workers and Cache Storage) | 매우 큼 (GB 단위) | 영구적 또는 설정된 만료 시간 | HTTPS 권장, 네트워크 요청 가로채기 및 캐시 제공 | 오프라인 웹 애플리케이션, 효율적인 리소스 캐싱 |

|

---

|